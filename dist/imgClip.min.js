!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.ImgClip=e():t.ImgClip=e()}(window,function(){return n={},i.m=r=[function(t,e,r){t.exports=r(1)},function(t,e,r){var c=r(2),o=r(4),l=r(5),a=r(6),u=r(7),n=function(){"use strict";function s(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};l(this,s);var n=t.uploadEl,i=t.imgEl,o=t.boxEl,a=t.frameEl;this.uploadEl=n,this.imgEl=i,this.boxEl=o,this.frameEl=a,this.options=e,this.hooks=r,this.init()}var t,e,r,n,i;return a(s,[{key:"init",value:function(){this.registerListener(),this.data={finalLeft:0,finalTop:0},this.events={touchstartEv:{}},this.scaleConvertRatio=4e3,this.defaultScale=1,this.scale=1,this.options.biggestScale=2,this.options.minimalScale=.1,this.options.singleBiggestScale=.3,this.devicePixelRatio=(3<window.devicePixelRatio?3:window.devicePixelRatio)||1}},{key:"registerListener",value:function(){var e=this;this.uploadEl.onchange=this.localImgHandle.bind(this),this.boxEl.addEventListener("touchstart",function(t){if(e.events.touchstartEv=t.touches[0],2===t.touches.length){if(!e.options.scaleEnable)return;e.touchStartDistance=u.getDistance({x:t.touches[0].pageX,y:t.touches[0].pageY},{x:t.touches[1].pageX,y:t.touches[1].pageY})}e.isInImgArea(e.events.touchstartEv)||(e.dragable=!1)}),this.boxEl.addEventListener("touchmove",function(t){if(t.preventDefault(),2<=t.touches.length){if(!e.options.scaleEnable)return;e.twoFingersScale(t)}else requestAnimationFrame?requestAnimationFrame(e.dragging.bind(e,t)):e.dragging(t)}),this.boxEl.addEventListener("touchend",function(){e.dragable=!0})}},{key:"destory",value:(i=o(c.mark(function t(){return c.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.wait(1e3);case 2:this.uploadEl.value="",this.imgEl.src="",this.data={finalLeft:0,finalTop:0},this.imgEl.style.transform=u.getTransformMatrix({scale:1,translateX:0,translateY:0}),this.previewObjectUrl&&window.URL.revokeObjectURL(this.previewObjectUrl);case 7:case"end":return t.stop()}},t,this)})),function(){return i.apply(this,arguments)})},{key:"tapHooks",value:function(t,e){this.hooks[t]&&this.hooks[t](e)}},{key:"dragging",value:function(t){if(!1!==this.dragable){var e=this.events.touchstartEv,r=t.touches[0],n=r.pageX-e.pageX,i=r.pageY-e.pageY;this.data.finalLeft+=n,this.data.finalTop+=i,this.imgEl.style.transform=u.getTransformMatrix({scale:this.scale,translateX:this.data.finalLeft,translateY:this.data.finalTop}),this.events.touchstartEv=r}}},{key:"twoFingersScale",value:function(t){var e=t.touches[0],r=t.touches[1],n=u.getDistance({x:e.pageX,y:e.pageY},{x:r.pageX,y:r.pageY}),i=this.distanceToScale(n);this.scale=this.getFinalScale(i),this.imgEl.style.transform=u.getTransformMatrix({scale:this.scale,translateX:this.data.finalLeft,translateY:this.data.finalTop})}},{key:"getFinalScale",value:function(t){var e,r=this.options,n=r.minimalScale,i=r.biggestScale;return e=(e=this.scale*t)<n&&n||i<e&&i||e}},{key:"distanceToScale",value:function(t){var e=(t-this.touchStartDistance)/this.scaleConvertRatio,r=Math.abs(e)>this.options.singleBiggestScale&&this.options.singleBiggestScale||Math.abs(e);return 0<e?r:Number("-".concat(r))}},{key:"isInImgArea",value:function(t){var e=this.getOffset(this.imgEl),r=t.pageX,n=t.pageY;return r>e.x.min&&r<e.x.max&&n>e.y.min&&n<e.y.max}},{key:"getOffset",value:function(t){var e={x:{},y:{}};if(t.getBoundingClientRect){var r=t.getBoundingClientRect();e.x={min:r.left,max:r.left+r.width},e.y={min:r.top,max:r.top+r.height},e.width=r.width,e.height=r.height}return e}},{key:"getClipImgArea",value:(n=o(c.mark(function t(){var e,r,n,i,o,a,s=arguments;return c.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=0<s.length&&void 0!==s[0]?s[0]:"blob",r=1<s.length&&void 0!==s[1]?s[1]:{},n=this.getOffset(this.imgEl),i=this.getOffset(this.frameEl),o=this.computedOrigin(n,i),t.next=8,this.clip(o,this.imgEl);case 8:if(a=t.sent,this.hooks.afterClip&&this.hooks.afterClip.params&&"formData"===this.hooks.afterClip.params.type?this.tapHooks("afterClip",this.createFormData(a,r)):this.tapHooks("afterClip",a),this.destory(),"formData"===e)return t.abrupt("return",this.createFormData(a,r));t.next=13;break;case 13:return t.abrupt("return",a);case 14:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"createFormData",value:function(t,e){var r=1<arguments.length&&void 0!==e?e:{},n=new FormData;for(var i in n.append("file",t),r)r.hasOwnProperty(i)&&n.append(i,r[i]);return n}},{key:"computedOrigin",value:function(t,e){var r={},n={width:0,height:0};r.relateFrameLeft=0<t.x.min-e.x.min?t.x.min-e.x.min:0,r.relateFrameTop=0<t.y.min-e.y.min?t.y.min-e.y.min:0,r.left=t.x.min-e.x.min<0?Math.abs(t.x.min-e.x.min):0,r.top=t.y.min-e.y.min<0?Math.abs(t.y.min-e.y.min):0;var i=t.y.max-e.y.max,o=t.x.max-e.x.max;return 0<i&&(n.height=i),0<o&&(n.width=o),r.width=t.width-Math.abs(r.left)-n.width,r.height=t.height-Math.abs(r.top)-n.height,r.left=Math.abs(r.left),r.top=Math.abs(r.top),this.getRealOrigin(r)}},{key:"getRealOrigin",value:function(e){var r=this.defaultScale*this.scale;return Object.keys(e).forEach(function(t){["relateFrameLeft","relateFrameTop"].includes(t)||(e[t]/=r)}),e}},{key:"fileToBase64",value:function(n){return new Promise(function(t,e){var r=new FileReader;r.readAsDataURL(n),r.onloadend=function(){t(r.result)},r.onerror=e})}},{key:"clip",value:(r=o(c.mark(function t(e,r){var n,i,o;return c.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return(n=document.createElement("canvas")).width=this.frameEl.offsetWidth*this.devicePixelRatio,n.height=this.frameEl.offsetHeight*this.devicePixelRatio,n.style.background="#000",n.style.width="".concat(this.frameEl.offsetWidth,"px"),n.style.height="".concat(this.frameEl.offsetHeight,"px"),n.style.position="fixed",(i=n.getContext("2d")).drawImage(r,e.left,e.top,e.width,e.height,e.relateFrameLeft*this.devicePixelRatio,e.relateFrameTop*this.devicePixelRatio,e.width*(this.defaultScale*this.scale*this.devicePixelRatio),e.height*(this.defaultScale*this.scale*this.devicePixelRatio)),i.backingStorePixelRatio||i.webkitBackingStorePixelRatio||i.mozBackingStorePixelRatio||i.msBackingStorePxelRatio||i.oBackingStorePxelRatio,t.next=13,u.canvasToBlob(n);case 13:return o=t.sent,this.download(o),t.abrupt("return",o);case 16:case"end":return t.stop()}},t,this)})),function(t,e){return r.apply(this,arguments)})},{key:"download",value:(e=o(c.mark(function t(e){var r;return c.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:(r=document.createElement("a")).href=window.URL.createObjectURL(e),r.download="clipedImg.png",r.click();case 4:case"end":return t.stop()}},t)})),function(t){return e.apply(this,arguments)})},{key:"previewImg",value:function(n,t){if(n){var i=this;n.style.display="none",n.onload=function(){n.originalSize={width:this.width,height:this.height};var t=window.innerWidth,e=i.options.imgWidth;e=e.includes("vw")?t*e.replace("vw","")/100:e.replace("px",""),i.defaultScale=e/this.width;var r={x:(t-e)/2,y:(i.boxEl.offsetHeight-this.height*i.defaultScale)/2};i.data.finalLeft=r.x,i.data.finalTop=r.y,n.style.transform=u.getTransformMatrix({scale:this.scale,translateX:r.x,translateY:r.y}),n.style.width="".concat(e,"px"),n.style.display="block"},n.src=t}}},{key:"localImgHandle",value:(t=o(c.mark(function t(){var e,r,n;return c.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.uploadEl.files[0])return this.tapHooks("beforeImgLoad"),t.next=5,this.fileToBase64(e);t.next=10;break;case 5:r=t.sent,n="",window.URL.createObjectURL?this.previewObjectUrl=n=window.URL.createObjectURL(e):n=r,this.previewImg(this.imgEl,n),this.tapHooks("beforeImgLoaded");case 10:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)})}]),s}();t.exports=n,t.exports.default=n},function(t,e,r){t.exports=r(3)},function(t,e,r){var n=function(a){"use strict";var c,t=Object.prototype,u=t.hasOwnProperty,e="function"==typeof Symbol?Symbol:{},i=e.iterator||"@@iterator",r=e.asyncIterator||"@@asyncIterator",n=e.toStringTag||"@@toStringTag";function s(t,e,r,n){var o,a,s,c,i=e&&e.prototype instanceof m?e:m,l=Object.create(i.prototype),u=new T(n||[]);return l._invoke=(o=t,a=r,s=u,c=f,function(t,e){if(c===d)throw new Error("Generator is already running");if(c===g){if("throw"===t)throw e;return P()}for(s.method=t,s.arg=e;;){var r=s.delegate;if(r){var n=L(r,s);if(n){if(n===v)continue;return n}}if("next"===s.method)s.sent=s._sent=s.arg;else if("throw"===s.method){if(c===f)throw c=g,s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);c=d;var i=h(o,a,s);if("normal"===i.type){if(c=s.done?g:p,i.arg===v)continue;return{value:i.arg,done:s.done}}"throw"===i.type&&(c=g,s.method="throw",s.arg=i.arg)}}),l}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}a.wrap=s;var f="suspendedStart",p="suspendedYield",d="executing",g="completed",v={};function m(){}function o(){}function l(){}var y={};y[i]=function(){return this};var x=Object.getPrototypeOf,w=x&&x(x(R([])));w&&w!==t&&u.call(w,i)&&(y=w);var b=l.prototype=m.prototype=Object.create(y);function E(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function k(c,l){var e;this._invoke=function(r,n){function t(){return new l(function(t,e){!function e(t,r,n,i){var o=h(c[t],c,r);if("throw"!==o.type){var a=o.arg,s=a.value;return s&&"object"==typeof s&&u.call(s,"__await")?l.resolve(s.__await).then(function(t){e("next",t,n,i)},function(t){e("throw",t,n,i)}):l.resolve(s).then(function(t){a.value=t,n(a)},function(t){return e("throw",t,n,i)})}i(o.arg)}(r,n,t,e)})}return e=e?e.then(t,t):t()}}function L(t,e){var r=t.iterator[e.method];if(r===c){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=c,L(t,e),"throw"===e.method))return v;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var n=h(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,v;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=c),e.delegate=null,v):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function R(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function t(){for(;++r<e.length;)if(u.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=c,t.done=!0,t};return n.next=n}}return{next:P}}function P(){return{value:c,done:!0}}return o.prototype=b.constructor=l,l.constructor=o,l[n]=o.displayName="GeneratorFunction",a.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===o||"GeneratorFunction"===(e.displayName||e.name))},a.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,n in t||(t[n]="GeneratorFunction")),t.prototype=Object.create(b),t},a.awrap=function(t){return{__await:t}},E(k.prototype),k.prototype[r]=function(){return this},a.AsyncIterator=k,a.async=function(t,e,r,n,i){void 0===i&&(i=Promise);var o=new k(s(t,e,r,n),i);return a.isGeneratorFunction(e)?o:o.next().then(function(t){return t.done?t.value:o.next()})},E(b),b[n]="Generator",b[i]=function(){return this},b.toString=function(){return"[object Generator]"},a.keys=function(r){var n=[];for(var t in r)n.push(t);return n.reverse(),function t(){for(;n.length;){var e=n.pop();if(e in r)return t.value=e,t.done=!1,t}return t.done=!0,t}},a.values=R,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=c,this.done=!1,this.delegate=null,this.method="next",this.arg=c,this.tryEntries.forEach(O),!t)for(var e in this)"t"===e.charAt(0)&&u.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=c)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function t(t,e){return o.type="throw",o.arg=r,n.next=t,e&&(n.method="next",n.arg=c),!!e}for(var e=this.tryEntries.length-1;0<=e;--e){var i=this.tryEntries[e],o=i.completion;if("root"===i.tryLoc)return t("end");if(i.tryLoc<=this.prev){var a=u.call(i,"catchLoc"),s=u.call(i,"finallyLoc");if(a&&s){if(this.prev<i.catchLoc)return t(i.catchLoc,!0);if(this.prev<i.finallyLoc)return t(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return t(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return t(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&u.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),O(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;O(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:R(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=c),v}},a}(t.exports);try{regeneratorRuntime=n}catch(t){Function("r","regeneratorRuntime = r")(n)}},function(t,e){function c(t,e,r,n,i,o,a){try{var s=t[o](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,i)}t.exports=function(s){return function(){var t=this,a=arguments;return new Promise(function(e,r){var n=s.apply(t,a);function i(t){c(n,e,r,i,o,"next",t)}function o(t){c(n,e,r,i,o,"throw",t)}i(void 0)})}}},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.exports=function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}},function(t,e){t.exports={isNumber:function(t){return/^[0-9]+$/.test(t)},countTime:function(t,e){var r=t,n=setTimeout(function(){--r<0&&(e(),clearTimeout(n))},r)},wait:function(r){return new Promise(function(t){var e=setTimeout(function(){clearTimeout(e),t()},r)})},getTransformMatrix:function(t){var e=t.scale,r=t.scaleX,n=void 0===r?1:r,i=t.scaleY,o=void 0===i?1:i,a=t.translateX,s=t.translateY;return e&&(o=n=e),"matrix(".concat(n,", 0, 0, ").concat(o,", ").concat(a,", ").concat(s,")")},getDistance:function(t,e){var r=e.x-t.x,n=e.y-t.y;return Math.sqrt(r*r+n*n)},dataURLToBlob:function(t){for(var e=t.split(","),r=e[0].match(/:(.*?);/)[1],n=atob(e[1]),i=n.length,o=new Uint8Array(i);i--;)o[i]=n.charCodeAt(i);return new Blob([o],{type:r})},canvasToBlob:function(r){return new Promise(function(t,e){Blob||e("Feature Blob does not exist"),HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,r){for(var n=atob(this.toDataURL(e,r)).split(",")[1],i=n.length,o=new Uint8Array(i),a=0;a<i;a++)o[a]=n.charCodeAt(a);callback(new Blob([o],{type:e||"image/png"}))}}),r.toBlob(t,"image/png")})}}}],i.c=n,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0);function i(t){if(n[t])return n[t].exports;var e=n[t]={i:t,l:!1,exports:{}};return r[t].call(e.exports,e,e.exports,i),e.l=!0,e.exports}var r,n});